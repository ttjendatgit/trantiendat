---
title: "Blog 2"
date: "2025-09-09"
weight: 1
chapter: false
pre: " <b> 3.2. </b> "
---


# Gain Compliance Insights into Your AWS Environment with Amazon Q Business

**Authors:** Jegan Sundarapandian, Neeharika Naidu and Snehal Nahar on 22 MAY 2025 in Amazon Q Business, AWS Config, Customer Solutions, Management & Governance, Management Tools, Technical Guide Permalink

Enterprise organizations managing multiple AWS accounts face complexity as their cloud infrastructure expands. The exponential growth of resources, coupled with diverse configuration requirements across different business units, creates significant challenges in maintaining effective oversight of AWS environments.

AWS Config is a service that continuously assesses, audits, and validates the configuration and relationships of your resources on AWS, on-premises, and on other clouds. AWS Config data is stored in secure Amazon S3 buckets.
When combined with Amazon Q Business's natural language processing capabilities, this AWS Config data can be used to analyze AWS resource configurations, gather insights, and take action.

In this blog post, we'll show how security and compliance teams can now use AWS Config and Amazon Q Business to gain insights into their AWS environments. By leveraging natural language queries, teams can access critical compliance insights and proactively identify potential risks as well as determine remediation actions.

# Solution Overview
Our solution addresses this challenge by integrating AWS Config, Amazon S3, and Amazon Q Business to create a natural language interface for querying AWS resource configurations. Here's how it works:

1. **Extract Relevant AWS Config Data:** Our solution periodically extracts AWS Config data from a central Amazon S3 Bucket and copies this data to a secure S3 Bucket in an audit account. This is done for a list of selected AWS Accounts and Regions.
2. **Process Data with Amazon Q Business:** We then configure Q Business to analyze the AWS Config data stored in the secure S3 bucket in your audit account and create a queryable knowledge base using natural language.
3. **Query the Knowledge Base with Natural Language:** With the knowledge base generated by Q Business, users can now ask questions in natural language about their AWS environment, such as "Which EC2 instances are running in my us-west-2 account?" or "What is the configuration of my RDS databases in the development environment?". Q Business will then provide relevant information from the underlying AWS Config data.

By implementing this solution, your security team members can easily access and understand AWS resource configurations, their compliance status, and identify remediation actions through simple natural language questions.

# Solution Architecture

<p align="center">
  <img src="/images/3-BlogsTranslated/3.2-Blog2/blog3.2_1.png" alt="Figure 1" />
  <br/>
  <strong style="font-size: 18px;">Figure 1: Solution Architecture Diagram</strong>
</p>

# Prerequisites
In a multi-account AWS environment, audit accounts and log archive accounts are shared AWS accounts used by security and compliance teams. The log archive account contains a central Amazon S3 repository to store copies of all logs, including AWS CloudTrail and AWS Config log files for all other accounts in your AWS Organization.

The audit account should be restricted to security and compliance teams, with auditor (read-only) and administrator (full access) roles across all accounts in the AWS Organization. These roles are designed for use by security and compliance teams to conduct audits through AWS mechanisms.

This solution is designed to be deployed in an audit account, which can provide a segregated environment to host the AWS Config data needed for Amazon Q Business. We recommend you deploy this solution in a separate audit account from the central log archive account.

Before diving into the solution, let's review the prerequisites needed to get started:

1. Necessary AWS Identity and Access Management (IAM) access in the log archive and audit account where this solution will be deployed.
2. Access to the AWS Console of the audit account.
3. AWS CLI to deploy necessary artifacts using AWS CloudFormation.
4. SAM CLI – Install SAM CLI. The Serverless Application Model (SAM) CLI is an extension of the AWS CLI that adds functionality for building and testing Lambda applications.
5. Set up Q Business with necessary permissions.
6. Configure an IAM Identity Center instance for the Amazon Q Business application to enable managing end user access to your Amazon Q Business application.

# How to Build and Deploy the Solution

**Step 1: Deploy S3 read-only role in the log account hosting the central S3 bucket for AWS Config.**
Using AWS CLI on the log account, create the ConfigDataReadRole with trust policy.

aws iam create-role \
    --role-name ConfigDataReadRole \
    --assume-role-policy-document '{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "AWS": "arn:aws:iam::<REPLACE WITH AUDIT ACCOUNT ID>:root"
            },
            "Action": "sts:AssumeRole",
            "Condition": {}
        }
    ]
}'

Then attach the AmazonS3ReadOnlyAccess managed policy.

aws iam attach-role-policy \
    --role-name ConfigDataReadRole \
    --policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess


**Step 2: Deploy the solution in the audit account**

Using AWS CLI on the audit account, deploy the solution.


git clone https://github.com/aws-samples/sample-Compliance-Insights-Using-Amazon-Q
cd sample-Compliance-Insights-using-Amazon-Q
sam deploy —guided —capabilities CAPABILITY_NAMED_IAM

SAM Deployment Parameters:
Stack Name: Name of the deployed AWS CloudFormation stack.
Example: Stack Name : config-copy-stack

AWS Region: AWS region where the stack will be deployed.
Example: AWS Region : us-east-1

Parameter SourceBucketArn: Bucket ARN for Central AWS Config S3 Bucket in the Log account.
Example: Parameter SourceBucketArn: arn:aws:s3:::aws-controltower-logs-123456789101-us-east-1

Parameter AccountList: Provide a comma-separated list of AWS account numbers from which AWS Config data will be extracted and copied to the audit account.
Example: Parameter AccountList: 012345678910,123456789101

Parameter RegionList: Provide a comma-separated list of AWS regions from which AWS Config data will be extracted to the audit account.
Example: Parameter RegionList : us-east-1,eu-west-1

Parameter SourceAccountId: Provide the AWS account number of your AWS log archive account in your organization, which contains the source AWS Config logs.
Example: Parameter SourceAccountId : 123456789101

Other SAM CLI Inputs

#Shows you resources changes to be deployed and require a 'Y' to initiate deploy
Confirm changes before deploy [Y/n]: Y

#SAM needs permission to be able to create roles to connect to the resources in your template
Allow SAM CLI IAM role creation [Y/n]: Y

#Preserves the state of previously provisioned resources when an operation fails
Disable rollback [Y/n]: Y

Save arguments to configuration file [Y/n]: Y
SAM configuration file [samconfig.toml]: samconfig.toml
SAM configuration environment [default]: default

After the SAM deployment completes, run the following SAM command and note the OutputValue of the OutputKey – DestinationBucketName. This S3 Bucket Name will be used as a parameter when deploying the Q Business CloudFormation Template in Step 3.


sam list stack-outputs --stack-name config-copy-stack --output table

**Step 3: Deploy and configure Q Business**

Amazon Q Business is a service that enables you to build intelligent search and analysis applications on top of your enterprise data. In this example, we'll use Q Business to analyze compliance-related data stored in an S3 bucket.

The CloudFormation template we'll use provisions the following resources:

1. Q Business Application: The main application that will host our compliance analysis experience.
2. Q Business Index: The index that the application will use to quickly search and retrieve relevant data.
3. Q Business Retriever: Connects the application to the index, enabling search and retrieval functionality.
4. Q Business Data Source: Configures the S3 bucket as a data source for the application. The S3 data source will be set up to run a sync task weekly at 8 AM Monday UTC time.
5. Q Business Web Experience: Provides a custom web interface to interact with the Q Business application.
6. IAM Permissions and Policies: Grants necessary permissions for Q Business resources to access the S3 bucket and perform actions within the application.

Let's walk through the steps to deploy this Q Business application.

**Deploy the CloudFormation Template**

1. Log into the AWS Console and navigate to CloudFormation.
2. Click "Create stack" and select "With new resources (standard)".
3. Download the CloudFormation template from Github to deploy Q Business.
4. Select "Upload a template file" and choose the CloudFormation template you've been provided.
5.Fill in the required parameters:

QBusinessApplicationName: Your Amazon Q Business application name.

S3BucketName: Name of the S3 bucket containing the compliance data collected earlier in Step 3.

UseIDC: Set to "true" if you want to use AWS IAM Identity Center to authenticate users.

UseIdP: Set to "true" if you want to use an external Identity Provider (IdP) to authenticate users.

IdentityCenterArn: ARN of your IAM Identity Center instance (required if UseIDC is "true").

ExternalIdPArn: ARN of your external IdP (required if UseIdP is "true").

6. Review the template and its parameters, then click "Next" to continue.
7. On the next page, configure any additional stack options if needed, then click "Next".
8. Review the stack details and acknowledge any required capabilities, then click "Create stack" to deploy the resources.

The CloudFormation deployment will take a few minutes to complete. Once the stack is in "CREATE_COMPLETE" status, you can proceed to the next steps.

**Assign Users and Groups**
After deploying the CloudFormation stack, you'll need to manually assign users and groups to the Q Business application. Here's how:

1. In the AWS Console, navigate to Amazon Q Business.
2. Click on the application name created by the template.
3. In the "User access" section, select "Manage user access".
4. Select "Add groups and users", then choose either "Add and assign new users" or "Assign existing users and groups".
5. Provide the group/user name.
6. Select the group and choose "Assign".
7. Select the appropriate subscription package (e.g., Q Business Pro).
8. Select "Confirm" to complete the assignment.

**Access the Q Business Web Experience**
You can now access the custom web experience for your Q Business application using the URL output by the CloudFormation template. The web experience provides a user-friendly interface to search, browse, and interact with your compliance data stored in your S3 bucket.

**Test the Solution**

To test the solution, we'll log into the Amazon Q Business application with credentials and interact using the following questions:

To test the solution, we'll log into the Amazon Q Business Application with the credentials of the users who were previously assigned to the Q Business application. Let's interact using the following questions:

1. List all non-compliant S3 buckets

2. When was the group "name of group" created and when did it become non-compliant

3. How can we remediate the non-compliant bucket "name of bucket"

<p align="center"> <img src="/images/3-BlogsTranslated/3.2-Blog2/blog3.2_2.png" alt="Figure 2" /> <br/> <strong style="font-size: 18px;">Figure 2: To list non-compliant S3 buckets</strong> </p><p align="center"> <img src="/images/3-BlogsTranslated/3.2-Blog2/blog3.2_3.png" alt="Figure 3" /> <br/> <strong style="font-size: 18px;">Figure 3: To learn when an S3 bucket became non-compliant</strong> </p><p align="center"> <img src="/images/3-BlogsTranslated/3.2-Blog2/blog3.2_4.png" alt="Figure 4" /> <br/> <strong style="font-size: 18px;">Figure 4: To remediate a non-compliant S3 bucket</strong> </p>

# Cleanup
1. Delete the config-copy-stack application you created, using SAM CLI.
sam delete
2. Delete the S3 read-only role in the log account.
aws iam delete-role \
--role-name ConfigDataReadRole
3. Delete Users and Groups in the Audit Account.
4. Locate and delete the stack created by the CloudFormation template deployment.

# Conclusion
By integrating AWS Config and Amazon Q Business, you can harness the power of natural language processing to gain insights into your AWS environment. This solution enables your team members to easily access and understand their AWS resource configurations. As your cloud infrastructure grows, this solution can help you stay on top of your resource configurations and make informed decisions to optimize your AWS environment. Deploy this AWS Config and Amazon Q Business integration to gain deeper visibility and compliance insights across your entire AWS environment.